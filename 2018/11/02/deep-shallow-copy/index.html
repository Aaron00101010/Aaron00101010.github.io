<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="description" content="Aaron&#39;s blog"><meta name="keyword" content="blog,front end,css,html,javascript"><link rel="shortcut icon" href="/css/images/logo.png"><title>javascript中的深浅拷贝 | Aaron&#39;s Blog</title><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script><script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script></head><div class="wechat-share"><img src="/css/images/logo.png" alt="logo"></div><body><div id="container"><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/"><div class="logo"></div><span><svg height="60" width="250" id="header-svg"><symbol id="s-text"><text text-anchor="left" x="0%" y="50%" dy=".35em">Aaron's Blog</text></symbol><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use></svg><style>#header-svg{position:absolute;top:0}@media screen and (max-width:768px){#header-svg{top:-7px}}.text{fill:none;stroke-width:2;stroke-linejoin:round;stroke-dasharray:40 185;stroke-dashoffset:0;-webkit-animation:stroke 8s infinite linear;animation:stroke 8s infinite linear;font-size:40px;line-height:1;height:40px}.text:nth-child(5n+1){stroke:#f2385a;-webkit-animation-delay:-1.6s;animation-delay:-1.6s}.text:nth-child(5n+2){stroke:#f5a503;-webkit-animation-delay:-3.2s;animation-delay:-3.2s}.text:nth-child(5n+3){stroke:#42b983;-webkit-animation-delay:-4.8s;animation-delay:-4.8s}.text:nth-child(5n+4){stroke:#56d9cd;-webkit-animation-delay:-6.4s;animation-delay:-6.4s}.text:nth-child(5n+5){stroke:#3aa1bf;-webkit-animation-delay:-8s;animation-delay:-8s}@-webkit-keyframes stroke{100%{stroke-dashoffset:-225}}@keyframes stroke{100%{stroke-dashoffset:-225}}</style></span></a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/tags/" class="item-link">Tags</a></li><li class="list-item"><a href="/archives/" class="item-link">Archives</a></li><li class="list-item"><a href="/project/" class="item-link">Project</a></li><li class="list-item"><a href="/about/" class="item-link">About</a></li></ul><div class="menu"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></div><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/tags/" class="menu-link">Tags</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="/project/" class="menu-link">Project</a></li><li class="menu-item"><a href="/about/" class="menu-link">About</a></li></ul></div></div></header><div id="article-banner"><h2>javascript中的深浅拷贝</h2><p class="post-date">2018-11-02</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>深拷贝（deep copy）与 浅拷贝（shallow copy）的区别在于对复合数据类型的复制，如果只是复制复合数据引用就是浅拷贝，如果是重新在新的内存空间中完全复制复杂对象则是深拷贝。<br>深拷贝主要目的用途就是拷贝一份不受原来对象影响的对象，用于数据传递(postMessage)或者数据持久化(IndexDB)等等。</p><h1 id="浅拷贝（shallow-copy）"><a href="#浅拷贝（shallow-copy）" class="headerlink" title="浅拷贝（shallow copy）"></a>浅拷贝（shallow copy）</h1><p>浅拷贝很好实现，其特点就是共享对象变化。</p><h2 id="对象拷贝"><a href="#对象拷贝" class="headerlink" title="对象拷贝"></a>对象拷贝</h2><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a>Object.assign()</h3><p>ES6 中拓展的拓展方法，可以将其他对象属性复制到拓展到目标对象上。只能拷贝对象自身属性，不能拷贝原型链上的属性（继承属性）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">1</span>, <span class="attr">c</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;;</span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a);</span><br><span class="line">a.c.push(<span class="number">4</span>);</span><br><span class="line">b.c; <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure><h3 id="搞一个"><a href="#搞一个" class="headerlink" title="搞一个"></a>搞一个</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shallowCopy</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> copyObj = &#123;&#125;;</span><br><span class="line">  <span class="comment">//不包含原型链属性</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    copyObj[item] = obj[item];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for(var key in obj)&#123;</span></span><br><span class="line">  <span class="comment">//   if(obj.hasOwnProperty(prop))&#123; //不包含原型链属性</span></span><br><span class="line">  <span class="comment">//     copyObj[key] = obj[key]</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> copyObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数组拷贝"><a href="#数组拷贝" class="headerlink" title="数组拷贝"></a>数组拷贝</h3><p>数组实例的 slice,concat 等等方法都可实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> b = a.slice();</span><br></pre></td></tr></table></figure><h1 id="深拷贝（deep-copy）"><a href="#深拷贝（deep-copy）" class="headerlink" title="深拷贝（deep copy）"></a>深拷贝（deep copy）</h1><p>深拷贝相对浅拷贝相对要复杂的许多，主要是 edge case 非常多，有很大原因是因为我们不知道我们拷贝的属性值是什么类型：</p><ul><li>循环引用对象的处理</li><li>RegExp/Map/Set/Array 等等的原生对象处理</li><li>Symbol 类型数据的拷贝</li><li>DOM,BOM 对象处理</li><li>Function 处理</li><li>对象原型链的处理</li><li>不可枚举属性的处理</li><li>so on…</li></ul><h2 id="jQuery-extend-deep-target-object1-object2…"><a href="#jQuery-extend-deep-target-object1-object2…" class="headerlink" title="jQuery.extend([deep],target,object1[,object2…])"></a>jQuery.extend([deep],target,object1[,object2…])</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> options,</span><br><span class="line">    name,</span><br><span class="line">    src,</span><br><span class="line">    copy,</span><br><span class="line">    copyIsArray,</span><br><span class="line">    clone,</span><br><span class="line">    target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">    i = <span class="number">1</span>,</span><br><span class="line">    length = <span class="built_in">arguments</span>.length,</span><br><span class="line">    deep = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle a deep copy situation</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">"boolean"</span>) &#123;</span><br><span class="line">    deep = target;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Skip the boolean and the target</span></span><br><span class="line">    target = <span class="built_in">arguments</span>[i] || &#123;&#125;;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle case when target is a string or something (possible in deep copy)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target)) &#123;</span><br><span class="line">    target = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Extend jQuery itself if only one argument is passed</span></span><br><span class="line">  <span class="keyword">if</span> (i === length) &#123;</span><br><span class="line">    target = <span class="keyword">this</span>;</span><br><span class="line">    i--;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="comment">// Only deal with non-null/undefined values</span></span><br><span class="line">    <span class="keyword">if</span> ((options = <span class="built_in">arguments</span>[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Extend the base object</span></span><br><span class="line">      <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</span><br><span class="line">        src = target[name];</span><br><span class="line">        copy = options[name];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prevent never-ending loop</span></span><br><span class="line">        <span class="keyword">if</span> (target === copy) &#123;</span><br><span class="line">          <span class="comment">//避免拷贝自身</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Recurse if we're merging plain objects or arrays</span></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          deep &amp;&amp;</span><br><span class="line">          copy &amp;&amp;</span><br><span class="line">          (jQuery.isPlainObject(copy) || (copyIsArray = <span class="built_in">Array</span>.isArray(copy)))</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">if</span> (copyIsArray) &#123;</span><br><span class="line">            copyIsArray = <span class="literal">false</span>;</span><br><span class="line">            clone = src &amp;&amp; <span class="built_in">Array</span>.isArray(src) ? src : [];</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Never move original objects, clone them</span></span><br><span class="line">          target[name] = jQuery.extend(deep, clone, copy); <span class="comment">//递归遍历拷贝</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// Don't bring in undefined values</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (copy !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">          target[name] = copy;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Return the modified object</span></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>从上面代码我们可以了解到 jQuery 实现的深复制并没有去处理 edge cases，个人认为主要是深克隆的应用场景就很有限，jQuery 只对 planinObject 进行深拷贝,各种 edge cases 都没有被处理，例如原生对象只是浅复制。</p><h2 id="deepClone"><a href="#deepClone" class="headerlink" title="_.deepClone"></a>_.deepClone</h2><p>部分核心代码如下:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Stack = <span class="built_in">require</span>(<span class="string">"./_Stack"</span>),</span><br><span class="line">  arrayEach = <span class="built_in">require</span>(<span class="string">"./_arrayEach"</span>),</span><br><span class="line">  assignValue = <span class="built_in">require</span>(<span class="string">"./_assignValue"</span>),</span><br><span class="line">  baseAssign = <span class="built_in">require</span>(<span class="string">"./_baseAssign"</span>),</span><br><span class="line">  baseAssignIn = <span class="built_in">require</span>(<span class="string">"./_baseAssignIn"</span>),</span><br><span class="line">  cloneBuffer = <span class="built_in">require</span>(<span class="string">"./_cloneBuffer"</span>),</span><br><span class="line">  copyArray = <span class="built_in">require</span>(<span class="string">"./_copyArray"</span>),</span><br><span class="line">  copySymbols = <span class="built_in">require</span>(<span class="string">"./_copySymbols"</span>),</span><br><span class="line">  copySymbolsIn = <span class="built_in">require</span>(<span class="string">"./_copySymbolsIn"</span>),</span><br><span class="line">  getAllKeys = <span class="built_in">require</span>(<span class="string">"./_getAllKeys"</span>),</span><br><span class="line">  getAllKeysIn = <span class="built_in">require</span>(<span class="string">"./_getAllKeysIn"</span>),</span><br><span class="line">  getTag = <span class="built_in">require</span>(<span class="string">"./_getTag"</span>),</span><br><span class="line">  initCloneArray = <span class="built_in">require</span>(<span class="string">"./_initCloneArray"</span>),</span><br><span class="line">  initCloneByTag = <span class="built_in">require</span>(<span class="string">"./_initCloneByTag"</span>),</span><br><span class="line">  initCloneObject = <span class="built_in">require</span>(<span class="string">"./_initCloneObject"</span>),</span><br><span class="line">  isArray = <span class="built_in">require</span>(<span class="string">"./isArray"</span>),</span><br><span class="line">  isBuffer = <span class="built_in">require</span>(<span class="string">"./isBuffer"</span>),</span><br><span class="line">  isMap = <span class="built_in">require</span>(<span class="string">"./isMap"</span>),</span><br><span class="line">  isObject = <span class="built_in">require</span>(<span class="string">"./isObject"</span>),</span><br><span class="line">  isSet = <span class="built_in">require</span>(<span class="string">"./isSet"</span>),</span><br><span class="line">  keys = <span class="built_in">require</span>(<span class="string">"./keys"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Used to compose bitmasks for cloning. */</span></span><br><span class="line"><span class="keyword">var</span> CLONE_DEEP_FLAG = <span class="number">1</span>,</span><br><span class="line">  CLONE_FLAT_FLAG = <span class="number">2</span>,</span><br><span class="line">  CLONE_SYMBOLS_FLAG = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** `Object#toString` result references. */</span></span><br><span class="line"><span class="keyword">var</span> argsTag = <span class="string">"[object Arguments]"</span>,</span><br><span class="line">  arrayTag = <span class="string">"[object Array]"</span>,</span><br><span class="line">  boolTag = <span class="string">"[object Boolean]"</span>,</span><br><span class="line">  dateTag = <span class="string">"[object Date]"</span>,</span><br><span class="line">  errorTag = <span class="string">"[object Error]"</span>,</span><br><span class="line">  funcTag = <span class="string">"[object Function]"</span>,</span><br><span class="line">  genTag = <span class="string">"[object GeneratorFunction]"</span>,</span><br><span class="line">  mapTag = <span class="string">"[object Map]"</span>,</span><br><span class="line">  numberTag = <span class="string">"[object Number]"</span>,</span><br><span class="line">  objectTag = <span class="string">"[object Object]"</span>,</span><br><span class="line">  regexpTag = <span class="string">"[object RegExp]"</span>,</span><br><span class="line">  setTag = <span class="string">"[object Set]"</span>,</span><br><span class="line">  stringTag = <span class="string">"[object String]"</span>,</span><br><span class="line">  symbolTag = <span class="string">"[object Symbol]"</span>,</span><br><span class="line">  weakMapTag = <span class="string">"[object WeakMap]"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arrayBufferTag = <span class="string">"[object ArrayBuffer]"</span>,</span><br><span class="line">  dataViewTag = <span class="string">"[object DataView]"</span>,</span><br><span class="line">  float32Tag = <span class="string">"[object Float32Array]"</span>,</span><br><span class="line">  float64Tag = <span class="string">"[object Float64Array]"</span>,</span><br><span class="line">  int8Tag = <span class="string">"[object Int8Array]"</span>,</span><br><span class="line">  int16Tag = <span class="string">"[object Int16Array]"</span>,</span><br><span class="line">  int32Tag = <span class="string">"[object Int32Array]"</span>,</span><br><span class="line">  uint8Tag = <span class="string">"[object Uint8Array]"</span>,</span><br><span class="line">  uint8ClampedTag = <span class="string">"[object Uint8ClampedArray]"</span>,</span><br><span class="line">  uint16Tag = <span class="string">"[object Uint16Array]"</span>,</span><br><span class="line">  uint32Tag = <span class="string">"[object Uint32Array]"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Used to identify `toStringTag` values supported by `_.clone`. */</span></span><br><span class="line"><span class="keyword">var</span> cloneableTags = &#123;&#125;;</span><br><span class="line">cloneableTags[argsTag] = cloneableTags[arrayTag] = cloneableTags[</span><br><span class="line">  arrayBufferTag</span><br><span class="line">] = cloneableTags[dataViewTag] = cloneableTags[boolTag] = cloneableTags[</span><br><span class="line">  dateTag</span><br><span class="line">] = cloneableTags[float32Tag] = cloneableTags[float64Tag] = cloneableTags[</span><br><span class="line">  int8Tag</span><br><span class="line">] = cloneableTags[int16Tag] = cloneableTags[int32Tag] = cloneableTags[</span><br><span class="line">  mapTag</span><br><span class="line">] = cloneableTags[numberTag] = cloneableTags[objectTag] = cloneableTags[</span><br><span class="line">  regexpTag</span><br><span class="line">] = cloneableTags[setTag] = cloneableTags[stringTag] = cloneableTags[</span><br><span class="line">  symbolTag</span><br><span class="line">] = cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] = cloneableTags[</span><br><span class="line">  uint16Tag</span><br><span class="line">] = cloneableTags[uint32Tag] = <span class="literal">true</span>;</span><br><span class="line">cloneableTags[errorTag] = cloneableTags[funcTag] = cloneableTags[</span><br><span class="line">  weakMapTag</span><br><span class="line">] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base implementation of `_.clone` and `_.cloneDeep` which tracks</span></span><br><span class="line"><span class="comment"> * traversed objects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @private</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; value The value to clone.</span></span><br><span class="line"><span class="comment"> * @param &#123;boolean&#125; bitmask The bitmask flags.</span></span><br><span class="line"><span class="comment"> *  1 - Deep clone</span></span><br><span class="line"><span class="comment"> *  2 - Flatten inherited properties</span></span><br><span class="line"><span class="comment"> *  4 - Clone symbols</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; [customizer] The function to customize cloning.</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; [key] The key of `value`.</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; [object] The parent object of `value`.</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; [stack] Tracks traversed objects and their clone counterparts.</span></span><br><span class="line"><span class="comment"> * @returns &#123;*&#125; Returns the cloned value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baseClone</span>(<span class="params">value, bitmask, customizer, key, object, stack</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result,</span><br><span class="line">    isDeep = bitmask &amp; CLONE_DEEP_FLAG,</span><br><span class="line">    isFlat = bitmask &amp; CLONE_FLAT_FLAG,</span><br><span class="line">    isFull = bitmask &amp; CLONE_SYMBOLS_FLAG;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (customizer) &#123;</span><br><span class="line">    result = object ? customizer(value, key, object, stack) : customizer(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (result !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> isArr = isArray(value);</span><br><span class="line">  <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">    result = initCloneArray(value);</span><br><span class="line">    <span class="keyword">if</span> (!isDeep) &#123;</span><br><span class="line">      <span class="keyword">return</span> copyArray(value, result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tag = getTag(value),</span><br><span class="line">      isFunc = tag == funcTag || tag == genTag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isBuffer(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cloneBuffer(value, isDeep);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag == objectTag || tag == argsTag || (isFunc &amp;&amp; !object)) &#123;</span><br><span class="line">      result = isFlat || isFunc ? &#123;&#125; : initCloneObject(value);</span><br><span class="line">      <span class="keyword">if</span> (!isDeep) &#123;</span><br><span class="line">        <span class="keyword">return</span> isFlat</span><br><span class="line">          ? copySymbolsIn(value, baseAssignIn(result, value))</span><br><span class="line">          : copySymbols(value, baseAssign(result, value));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!cloneableTags[tag]) &#123;</span><br><span class="line">        <span class="keyword">return</span> object ? value : &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      result = initCloneByTag(value, tag, isDeep);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Check for circular references and return its corresponding clone.</span></span><br><span class="line">  <span class="comment">// 利用栈来检测对象的循环引用</span></span><br><span class="line">  stack || (stack = <span class="keyword">new</span> Stack());</span><br><span class="line">  <span class="keyword">var</span> stacked = stack.get(value);</span><br><span class="line">  <span class="keyword">if</span> (stacked) &#123;</span><br><span class="line">    <span class="keyword">return</span> stacked;</span><br><span class="line">  &#125;</span><br><span class="line">  stack.set(value, result);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isSet(value)) &#123;</span><br><span class="line">    value.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">subValue</span>) </span>&#123;</span><br><span class="line">      result.add(</span><br><span class="line">        baseClone(subValue, bitmask, customizer, subValue, value, stack)</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isMap(value)) &#123;</span><br><span class="line">    value.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">subValue, key</span>) </span>&#123;</span><br><span class="line">      result.set(</span><br><span class="line">        key,</span><br><span class="line">        baseClone(subValue, bitmask, customizer, key, value, stack)</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> keysFunc = isFull</span><br><span class="line">    ? isFlat</span><br><span class="line">      ? getAllKeysIn</span><br><span class="line">      : getAllKeys</span><br><span class="line">    : isFlat</span><br><span class="line">      ? keysIn</span><br><span class="line">      : keys;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> props = isArr ? <span class="literal">undefined</span> : keysFunc(value);</span><br><span class="line">  arrayEach(props || value, <span class="function"><span class="keyword">function</span>(<span class="params">subValue, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (props) &#123;</span><br><span class="line">      key = subValue;</span><br><span class="line">      subValue = value[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Recursively populate clone (susceptible to call stack limits).</span></span><br><span class="line">    <span class="comment">// 递归遍历复制</span></span><br><span class="line">    assignValue(</span><br><span class="line">      result,</span><br><span class="line">      key,</span><br><span class="line">      baseClone(subValue, bitmask, customizer, key, value, stack)</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = baseClone;</span><br></pre></td></tr></table></figure><p>从上面代码我们可以了解到 lodash 的拷贝考虑了更多的情况，不仅仅考虑到循环引用，各种原生对象的拷贝（采用<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/API/DOM/The_structured_clone_algorithm#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5" target="_blank" rel="noopener">结构化克隆算法 </a>），甚至提供了自定一参数来实现自定义拷贝策略，功能很强大。</p><h2 id="JSON-parse-JSON-stringify"><a href="#JSON-parse-JSON-stringify" class="headerlink" title="JSON.parse()/JSON.stringify()"></a>JSON.parse()/JSON.stringify()</h2><p>通过 JSON 对象我们可以加将 对象转换为 JSON 字符串，或者将 JSON 字符串转换为对象。<br>JSON 是一种语法，与 javascript 字面量对象有一定交集，但是 JSON 方法只适用于 JSON 格式，能转换的对象就需要符合 JSON 格式。<br>如果数据属性值为 Function,Symbol,非字面量的 Object…等类型会被忽略，详情见<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON" target="_blank" rel="noopener">MDN JSON</a>。<br>如果对象中包含循环引用，则会抛出 TypeError: circular structure to JSON。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">copyByJSON</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringfiy(obj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="搞一个-1"><a href="#搞一个-1" class="headerlink" title="搞一个"></a>搞一个</h2><h3 id="只拷贝-PlainObject"><a href="#只拷贝-PlainObject" class="headerlink" title="只拷贝 PlainObject"></a>只拷贝 PlainObject</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* 建立被拷贝对象与拷贝对象建立联系，解决对象循环引用的问题 */</span></span><br><span class="line">  <span class="keyword">let</span> objMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line">  <span class="keyword">let</span> isPlainObject = <span class="function"><span class="params">obj</span> =&gt;</span></span><br><span class="line">    <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">"[object Object]"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">copyTarget</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isPlainObject(copyTarget)) &#123;</span><br><span class="line">      <span class="keyword">return</span> copyTarget;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 检查关联 */</span></span><br><span class="line">    <span class="keyword">if</span> (objMap.has(copyTarget)) &#123;</span><br><span class="line">      <span class="keyword">return</span> objMap.get(copyTarget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> copy = <span class="built_in">Array</span>.isArray(copyTarget) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="comment">/* 存储关联 */</span></span><br><span class="line">    objMap.set(copyTarget, copy);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> copyTarget) &#123;</span><br><span class="line">      <span class="keyword">if</span> (copyTarget.hasOwnProperty(key)) &#123;</span><br><span class="line">        <span class="keyword">let</span> value = copyTarget[key];</span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(value)) &#123;</span><br><span class="line">          copy[key] = clone(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          copy[key] = value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> clone(target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line">obj.self = obj;</span><br><span class="line"><span class="keyword">var</span> copyObj = deepClone(obj);</span><br><span class="line"><span class="built_in">console</span>.log(copyObj === copyObj.self);</span><br><span class="line"><span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="拷贝不可枚举属性"><a href="#拷贝不可枚举属性" class="headerlink" title="拷贝不可枚举属性"></a>拷贝不可枚举属性</h3><p>通过getOwnPropertyNames属性获取所有属性进行拷贝<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> objMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line">    <span class="keyword">let</span> isPlainObject = <span class="function"><span class="params">obj</span>=&gt;</span><span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">"[object Object]"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">copyTarget</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (copyTarget === <span class="literal">null</span> || <span class="keyword">typeof</span> copyTarget !== <span class="string">"object"</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> copyTarget;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (objMap.has(copyTarget)) &#123;</span><br><span class="line">            <span class="keyword">return</span> objMap.get(copyTarget)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> copy = <span class="built_in">Array</span>.isArray(copyTarget) ? [] : &#123;&#125;</span><br><span class="line">        objMap.set(copyTarget, copy)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Object</span>.getOwnPropertyNames(copyTarget).forEach(<span class="function"><span class="params">key</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (copyTarget.hasOwnProperty(key)) &#123;</span><br><span class="line">                <span class="keyword">let</span> value = copyTarget[key];</span><br><span class="line">                <span class="keyword">if</span> (isPlainObject(value)) &#123;</span><br><span class="line">                    copy[key] = clone(value)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    copy[key] = value;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;)   </span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clone(target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line">obj.self = obj</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'test'</span>,&#123;<span class="attr">enumerable</span>:<span class="literal">false</span>,<span class="attr">value</span>:<span class="string">'test'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> copyObj = deepClone(obj)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(copyObj.test)</span><br><span class="line"><span class="comment">//test</span></span><br></pre></td></tr></table></figure><p></p><h3 id="RegExp-Date-等对象的拷贝"><a href="#RegExp-Date-等对象的拷贝" class="headerlink" title="RegExp,Date 等对象的拷贝"></a>RegExp,Date 等对象的拷贝</h3><p>对原生对象处理可以重新新建一个值相同的对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isRegExp = <span class="function"><span class="params">reg</span>=&gt;</span><span class="built_in">Object</span>.prototype.toString.call(reg)===<span class="string">'[object RegExp]'</span> </span><br><span class="line"><span class="keyword">let</span> isDate = <span class="function"><span class="params">date</span>=&gt;</span><span class="built_in">Object</span>.prototype.toString.call(date) === <span class="string">'[object Date]'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneRegExp</span>(<span class="params">reg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pattern = reg.valueOf();</span><br><span class="line">  <span class="keyword">var</span> flags = <span class="string">""</span>;</span><br><span class="line">  flags += pattern.global ? <span class="string">"g"</span> : <span class="string">""</span>;</span><br><span class="line">  flags += pattern.ignoreCase ? <span class="string">"i"</span> : <span class="string">""</span>;</span><br><span class="line">  flags += pattern.multiline ? <span class="string">"m"</span> : <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RegExp</span>(pattern.source, flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneDate</span>(<span class="params">date</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(date.valueOf())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>从上面可以看到对象的深拷贝要考虑的edge case还有非常多，这里只是试着解决几种情况。<br>在实际应用上，非要用深拷贝的场景十分有限，往往使用深拷贝能解决的问题能有更好的解决方案。<br>但是清楚的了解深拷贝能增进我们的对javascript基础的理解掌握，Bye。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.zhihu.com/question/47746441" target="_blank" rel="noopener">JavaScript 如何完整实现深度 Clone 对象？</a><br><a href="http://jerryzou.com/posts/dive-into-deep-clone-in-javascript/" target="_blank" rel="noopener">深入剖析 JavaScript 的深复制</a></p></section><div class="tags"><span>Tags:</span> <a href="/tags#shallow copy"><span class="tag-code">shallow copy</span> </a><a href="/tags#deep copy"><span class="tag-code">deep copy</span></a></div><div class="nav-container"><a class="nav-left" href="/2018/10/31/promise/"><span class="nav-arrow">← </span>搞一个基于Promise/A+规范的Promise</a></div><div id="disqus_thread"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#浅拷贝（shallow-copy）"><span class="toc-nav-text">浅拷贝（shallow copy）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#对象拷贝"><span class="toc-nav-text">对象拷贝</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Object-assign"><span class="toc-nav-text">Object.assign()</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#搞一个"><span class="toc-nav-text">搞一个</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#数组拷贝"><span class="toc-nav-text">数组拷贝</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#深拷贝（deep-copy）"><span class="toc-nav-text">深拷贝（deep copy）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#jQuery-extend-deep-target-object1-object2…"><span class="toc-nav-text">jQuery.extend([deep],target,object1[,object2…])</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#deepClone"><span class="toc-nav-text">_.deepClone</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#JSON-parse-JSON-stringify"><span class="toc-nav-text">JSON.parse()/JSON.stringify()</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#搞一个-1"><span class="toc-nav-text">搞一个</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#只拷贝-PlainObject"><span class="toc-nav-text">只拷贝 PlainObject</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#拷贝不可枚举属性"><span class="toc-nav-text">拷贝不可枚举属性</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#RegExp-Date-等对象的拷贝"><span class="toc-nav-text">RegExp,Date 等对象的拷贝</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#最后"><span class="toc-nav-text">最后</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考链接"><span class="toc-nav-text">参考链接</span></a></li></ol></li></ol></div></aside></main><script>(function () {
    var url = 'https://blog.noobcoder.club/2018/11/02/deep-shallow-copy/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url + Math.random())
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function () {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function () {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="' + src + '" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function () {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();</script><script>var disqus_shortname="aaron00101010",disqus_url="https://blog.noobcoder.club/2018/11/02/deep-shallow-copy/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//go.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><div class="scroll-top"><span class="arrow-icon"></span></div></div><footer class="app-footer"><p class="copyright">&copy; 2018 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a><br>Theme by <a href="https://github.com/yanm1ng">yanm1ng</a></p></footer><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){FastClick.attach(document.body)})</script><script>var hasLine="true";async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js",function(){$("figure pre").each(function(t,e){var a=$(this).parents("figure");"false"===hasLine&&a.find(".gutter").hide();var s=a.attr("class").split(" ")[1]||"code",i=$(this).html(),h=document.createElement("code");h.className=s,h.innerHTML=i,$(this).attr("class","").empty().html(h),a.attr("data-lang",s.toUpperCase()),hljs.highlightBlock(e)})})</script><script src="/js/script.js"></script></body></html>