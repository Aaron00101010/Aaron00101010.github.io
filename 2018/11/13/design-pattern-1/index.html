<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="description" content="Aaron&#39;s blog"><meta name="keyword" content="blog,front end,css,html,javascript"><link rel="shortcut icon" href="/css/images/logo.png"><title>JavaScript设计模式(一) | Aaron&#39;s Blog</title><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script><script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script></head><div class="wechat-share"><img src="/css/images/logo.png" alt="logo"></div><body><div id="container"><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/"><div class="logo"></div><span><svg height="60" width="250" id="header-svg"><symbol id="s-text"><text text-anchor="left" x="0%" y="50%" dy=".35em">Aaron's Blog</text></symbol><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use></svg><style>#header-svg{position:absolute;top:0}@media screen and (max-width:768px){#header-svg{top:-7px}}.text{fill:none;stroke-width:2;stroke-linejoin:round;stroke-dasharray:40 185;stroke-dashoffset:0;-webkit-animation:stroke 8s infinite linear;animation:stroke 8s infinite linear;font-size:40px;line-height:1;height:40px}.text:nth-child(5n+1){stroke:#f2385a;-webkit-animation-delay:-1.6s;animation-delay:-1.6s}.text:nth-child(5n+2){stroke:#f5a503;-webkit-animation-delay:-3.2s;animation-delay:-3.2s}.text:nth-child(5n+3){stroke:#42b983;-webkit-animation-delay:-4.8s;animation-delay:-4.8s}.text:nth-child(5n+4){stroke:#56d9cd;-webkit-animation-delay:-6.4s;animation-delay:-6.4s}.text:nth-child(5n+5){stroke:#3aa1bf;-webkit-animation-delay:-8s;animation-delay:-8s}@-webkit-keyframes stroke{100%{stroke-dashoffset:-225}}@keyframes stroke{100%{stroke-dashoffset:-225}}</style></span></a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/tags/" class="item-link">Tags</a></li><li class="list-item"><a href="/archives/" class="item-link">Archives</a></li><li class="list-item"><a href="/project/" class="item-link">Project</a></li><li class="list-item"><a href="/about/" class="item-link">About</a></li></ul><div class="menu"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></div><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/tags/" class="menu-link">Tags</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="/project/" class="menu-link">Project</a></li><li class="menu-item"><a href="/about/" class="menu-link">About</a></li></ul></div></div></header><div id="article-banner"><h2>JavaScript设计模式(一)</h2><p class="post-date">2018-11-13</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><h1 id="Constructor-构造器-模式"><a href="#Constructor-构造器-模式" class="headerlink" title="Constructor(构造器)模式"></a>Constructor(构造器)模式</h1><p>javascript 不支持类的概念，但是它支持通过对构造器函数使用 new 运算符来生成实例化对象，实例通过原型继承实例方法属性。<br><code>new Foo()</code>运算符的执行过程：</p><ol><li>创建一个继承<code>Foo.prototype</code>的新空对象</li><li>将构造函数中的<code>this</code>绑定到新创建的对象，执行构造函数内代码</li><li>如果构造函数没有<code>return</code>关键字，则返回新对象，否则返回<code>return</code>返回的值</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name = <span class="string">"Tony"</span>, age = <span class="string">"18"</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;,</span><br><span class="line">  getAge() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">new</span> Person().getName();</span><br><span class="line"><span class="comment">//"Tony"</span></span><br></pre></td></tr></table></figure><h1 id="Module-模块-模式"><a href="#Module-模块-模式" class="headerlink" title="Module(模块)模式"></a>Module(模块)模式</h1><p>javascript 中有集中用于实现模块的方法，包括：</p><ul><li>对象字面量表示法</li><li>Module 模式</li><li>AMD 模块</li><li>CommonJS 模块</li><li>ECMAScript Harmony(ES6)模块</li></ul><h2 id="对象字面量"><a href="#对象字面量" class="headerlink" title="对象字面量"></a>对象字面量</h2><p>使用对象字面量有利于组织与封装代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> moduleA = &#123;</span><br><span class="line">  propertyA: <span class="string">"123"</span>,</span><br><span class="line">  config: &#123;</span><br><span class="line">    language: <span class="string">"en"</span>,</span><br><span class="line">    useCaching: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  setConfig(config) &#123;</span><br><span class="line">    <span class="keyword">this</span>.config = <span class="built_in">Object</span>.assign(<span class="keyword">this</span>.config, config);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">moduleA.setConfig(&#123; <span class="attr">language</span>: <span class="string">"zh"</span> &#125;);</span><br><span class="line">moduleA.config.language;</span><br><span class="line"><span class="comment">//"zh"</span></span><br></pre></td></tr></table></figure><h2 id="Module-模块-模式-1"><a href="#Module-模块-模式-1" class="headerlink" title="Module(模块)模式"></a>Module(模块)模式</h2><p>在 javascript 中，Module 模式用于进一步模拟类的概念，是一个单独的对象拥有 <strong>共有/私有</strong> 方法和变量，从而避免污染全局作用域，只返回一个共有 API，降低代码冲突的可能性。<br>通过闭包的我们可以实现私有方法和变量。私有方法无法直接被调用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> counterModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//私有变量</span></span><br><span class="line">  <span class="keyword">let</span> counter = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//私有方法</span></span><br><span class="line">  <span class="keyword">let</span> log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(counter);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回共有方法</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    incrementCounter() &#123;</span><br><span class="line">      <span class="keyword">return</span> ++counter;</span><br><span class="line">    &#125;,</span><br><span class="line">    resetCounter() &#123;</span><br><span class="line">      counter = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//调用私有方法</span></span><br><span class="line">      log();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>这种模式的缺点：</p><ul><li>如果想改变方法变量的公有/私有性，则需要修改每一个调用该模块方法的地方。</li><li>对于私有方法属性无法创建自动化单元测试。</li></ul><h1 id="Revaling-Module-揭示模块-模式"><a href="#Revaling-Module-揭示模块-模式" class="headerlink" title="Revaling Module(揭示模块)模式"></a>Revaling Module(揭示模块)模式</h1><p>揭示模块模式与模块模式主要区别在于，所有方法变量都定义在私有作用于范围，只在底部指定共有方法名称与引用，改善代码可读性，一致性。私有方法可以更简洁的引用公有方法（无需重复模块变量名），暴露的方法变量名更加灵活。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> age = <span class="string">"18"</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateLogAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(publicGetAge());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">publicGetAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">publicLogAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    privateLogAge();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getAge: publicGetAge,</span><br><span class="line">    logAge: publicLogAge</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line">person.logAge;</span><br><span class="line"><span class="comment">//18</span></span><br></pre></td></tr></table></figure><h1 id="Singleton（单例）模式"><a href="#Singleton（单例）模式" class="headerlink" title="Singleton（单例）模式"></a>Singleton（单例）模式</h1><p>Singleton 模式限制了一个类只能实例化一次。如果类实例不存在则创建，存在则返回该实例。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Singleton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> Singleton.instance === <span class="string">"object"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Singleton.instance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.name = <span class="string">"singleton"</span>;</span><br><span class="line">  <span class="keyword">this</span>.data = &#123;&#125;;</span><br><span class="line">  Singleton.instance = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Singleton() === <span class="keyword">new</span> Singleton());</span><br><span class="line"><span class="comment">//true</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> singleton = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//在init中初始化对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//随机生成年龄</span></span><br><span class="line">    <span class="keyword">var</span> age = <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>));</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      getAge() &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getInstance() &#123;</span><br><span class="line">      <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">        <span class="comment">//调用方法时初始化，避免资源浪费</span></span><br><span class="line">        instance = init();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line">singleton.getInstance().getAge();</span><br><span class="line"><span class="comment">//17</span></span><br><span class="line">singleton.getInstance().getAge();</span><br><span class="line"><span class="comment">//17</span></span><br></pre></td></tr></table></figure><p>Singleton 的存在往往表明系统中的模块要么是紧密耦合，要么是逻辑过于分散。由于 Singleton 模式下依赖隐藏，创建多个实例的难度，Singleton 的测试会更加困难。</p><h1 id="Observer-观察者-模式"><a href="#Observer-观察者-模式" class="headerlink" title="Observer(观察者)模式"></a>Observer(观察者)模式</h1><p>在 Observer 模式下，一个对象（subject）维持一系列依赖于它的（观察者）对象，将对象（subject）有关状态的变更自动通知给它们。</p><p><img src="https://ws1.sinaimg.cn/large/e3c02d6fly1fx5lnmph49j20eq098q3d.jpg" alt="Observer pattern"></p><ul><li>Subject(目标)，维护一系列观察者，方便添加或删除观察者</li><li>Observer(观察者)，为那些在目标状态发生改变时需获得通知的对象提供一个更新接口。</li><li>ConcreteSubject(具体目标)，状态发生改变时，向 Observer 发出通知，存储 ConcreteObserver 的状态</li><li>ConcreteObserver(具体观察者)，存储一个指向 ConcreteSubject 的引用，实现 Observer 的更新接口，以使自身状态与目标保持一致。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ObserverList */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObserverList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observerList = [];</span><br><span class="line">&#125;</span><br><span class="line">ObserverList.prototype = &#123;</span><br><span class="line">  add(obj) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observerList.push(obj);</span><br><span class="line">  &#125;,</span><br><span class="line">  remove(obj) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="keyword">this</span>.observerList.indexOf(obj);</span><br><span class="line">    <span class="keyword">if</span> (index !== <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observerList.splice(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  empty() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observerList = [];</span><br><span class="line">  &#125;,</span><br><span class="line">  getListLength() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.observerList.length;</span><br><span class="line">  &#125;,</span><br><span class="line">  getByIndex(index) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.observerList[index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Subject */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observers = <span class="keyword">new</span> ObserverList();</span><br><span class="line">&#125;</span><br><span class="line">Subject.prototype = &#123;</span><br><span class="line">  addObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.add(observer);</span><br><span class="line">  &#125;,</span><br><span class="line">  removeObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.remove(observer);</span><br><span class="line">  &#125;,</span><br><span class="line">  notifyObservers(context) &#123;</span><br><span class="line">    <span class="keyword">let</span> observerCount = <span class="keyword">this</span>.observers.getListLength();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; observerCount; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observers.getByIndex(i).update(context);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Observer */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params">updateFn = function(</span>) </span>&#123;&#125;) &#123;</span><br><span class="line">  <span class="comment">/* 私有更新方法 */</span></span><br><span class="line">  <span class="keyword">this</span>.update = updateFn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ConcreteSubject */</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  _a: <span class="number">1</span>,</span><br><span class="line">  get a() &#123;</span><br><span class="line">    subject.notifyObservers(<span class="string">"getting a"</span>);</span><br><span class="line">    <span class="comment">// return this._a</span></span><br><span class="line">  &#125;,</span><br><span class="line">  set a(val) &#123;</span><br><span class="line">    subject.notifyObservers(<span class="string">"setting a"</span>);</span><br><span class="line">    <span class="keyword">this</span>._a = val;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> log1 = [];</span><br><span class="line"><span class="comment">/* ConcreteObserver */</span></span><br><span class="line"><span class="keyword">var</span> observer1 = <span class="keyword">new</span> Observer(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  log1.push(<span class="string">"log1:"</span> + val);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> log2 = [];</span><br><span class="line"><span class="keyword">var</span> observer2 = <span class="keyword">new</span> Observer(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  log2.push(<span class="string">"log2:"</span> + val);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.addObserver(observer1);</span><br><span class="line">subject.addObserver(observer2);</span><br><span class="line"></span><br><span class="line">obj.a = obj.a * <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(log1, log2);</span><br><span class="line"><span class="comment">/*["log1:getting a", "log1:setting a"] ["log2:getting a", "log2:setting a"]*/</span></span><br></pre></td></tr></table></figure><p><strong>Observer(观察者)模式和 Publish/Subscribe(发布/订阅)模式的区别</strong></p><p><img src="https://ws1.sinaimg.cn/large/e3c02d6fly1fx5lnmuag3j20dg08c74i.jpg" alt=""></p><p>在 javascaript 中，Observer 模式更常见的是一种变体实现 Publish/Subscribe 模式。<br>Observer 模式要求 Observer 置入 Subject 的 ObserverList 中（订阅 Subject）,以便于 Subject 触发这些 Observer,这样 Subject,Observer 就存在依赖关系。<br>Publish/Subscribe 模式区别在 Publisher 与 Subscriber 之间添加了一个 Topic/EventChannel 作为中间层，这样我们就解耦了 Publisher 与 Subscriber。在中间层我们可以自定义事件与传递的参数，允许订阅者通过自定义方法来注册事件，接收事件。</p><p>Observer 与 Pub/Sub 优点：</p><ul><li>帮助我们将程序分解为更小，更松散耦合的块，改进代码管理与复用性</li><li> 我们无需再去维护 ConcerteObserver 对象的状态，因为 ConcerteSubject 会执行 ConcerteObserver.update 自动更新其状态,解耦了我们的代码</li></ul><p>Observer 与 Pub/Sub 缺点：</p><ul><li>由于系统解耦，发布者  无法确保  订阅者代码正确执行</li><li>订阅者之间没有关联，无法感知替换发布者的成本。订阅者与发布者之间的动态关系，难以跟踪更新依赖。</li></ul><h2 id="Pub-Sub-实现"><a href="#Pub-Sub-实现" class="headerlink" title="Pub/Sub 实现"></a>Pub/Sub 实现</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pubsubModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* 订阅token累加器 */</span></span><br><span class="line">  <span class="keyword">let</span> subId = <span class="number">-1</span>,</span><br><span class="line">    <span class="comment">/* 中间层，事件通道topics */</span></span><br><span class="line">    topics = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">/* 发布，传入发布事件类型 */</span></span><br><span class="line">    publish(topic, ...arg) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      topics[topic].forEach(<span class="function"><span class="params">item</span> =&gt;</span> item.fn(arg));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* 订阅，传入订阅事件类型，回调函数 */</span></span><br><span class="line">    subscribe(topic, fn) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">        topics[topic] = [];</span><br><span class="line">      &#125;</span><br><span class="line">      topics[topic].push(&#123;</span><br><span class="line">        <span class="comment">/* 存入token,回调 */</span></span><br><span class="line">        token: ++subId,</span><br><span class="line">        fn</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> subId;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* 取消订阅，根据token取消订阅 */</span></span><br><span class="line">    unsubscribe(token) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> topics) &#123;</span><br><span class="line">        <span class="keyword">let</span> index = topics[key].findIndex(<span class="function"><span class="params">item</span> =&gt;</span> item.token === token);</span><br><span class="line">        <span class="keyword">if</span> (index !== <span class="number">-1</span>) &#123;</span><br><span class="line">          topics[key].splice(index, <span class="number">1</span>);</span><br><span class="line">          <span class="keyword">return</span> token;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscriberA = pubsubModule.subscribe(<span class="string">"you/is/five"</span>, data =&gt;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"subscriberA:i get you/is/five boradcast"</span>, <span class="string">"data:"</span> + data)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">var</span> subscriberB = pubsubModule.subscribe(<span class="string">"you/is/five"</span>, data =&gt;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"subscriberB:i get you/is/five boradcast"</span>, <span class="string">"data:"</span> + data)</span><br><span class="line">);</span><br><span class="line">pubsubModule.publish(<span class="string">"you/is/five"</span>, <span class="string">"just a joke!"</span>);</span><br><span class="line">pubsubModule.unsubscribe(subscriberA);</span><br><span class="line">pubsubModule.publish(<span class="string">"you/is/five"</span>, <span class="string">"is there subscriberA?nope"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">subscriberA:i get you/is/five boradcast data:just a joke!</span></span><br><span class="line"><span class="comment">pubsub:42 subscriberB:i get you/is/five boradcast data:just a joke!</span></span><br><span class="line"><span class="comment">pubsub:42 subscriberB:i get you/is/five boradcast data:is there subscriberA?nope</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="Mediator-中介者-模式"><a href="#Mediator-中介者-模式" class="headerlink" title="Mediator(中介者)模式"></a>Mediator(中介者)模式</h1><p><img src="https://ws1.sinaimg.cn/large/e3c02d6fly1fx6bb21hcnj20eg08qjrn.jpg" alt=""></p><p>Mediator 模式解耦代码的方式是：确保组件交互通过中心点 Mediator 来处理，而不是直接操作其他组件。<br>Vuex，Redux处理全局状态，部分组件之间通过Store来通信，可以看作Mediator模式的实现。</p><ul><li>优点：将系统组件之间的通信从多对多改为一对多，解耦程度高。</li><li>缺点：无法通过仅关注发布广播来来确定系统作何反应，因为无法确定该广播有哪些订阅者。<br>Mediator模式与Observer模式的差异：</li><li>Observer模式不存在封装单一对象来维持发布/订阅关系，Observer/Subject合作才能维持关系。</li><li>Mediator模式严格限制通过Mediator进行通信。</li></ul><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="javascript:;" target="_blank" rel="noopener">JavaScript 设计模式 - Addy Osmani</a></p></section><div class="tags"><span>Tags:</span> <a href="/tags#design pattern"><span class="tag-code">design pattern</span></a></div><div class="nav-container"><a class="nav-left" href="/2018/11/07/javascript-decoration/"><span class="nav-arrow">← </span>[译] javascript 装饰器</a></div><div id="disqus_thread"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Constructor-构造器-模式"><span class="toc-nav-text">Constructor(构造器)模式</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Module-模块-模式"><span class="toc-nav-text">Module(模块)模式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#对象字面量"><span class="toc-nav-text">对象字面量</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Module-模块-模式-1"><span class="toc-nav-text">Module(模块)模式</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Revaling-Module-揭示模块-模式"><span class="toc-nav-text">Revaling Module(揭示模块)模式</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Singleton（单例）模式"><span class="toc-nav-text">Singleton（单例）模式</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Observer-观察者-模式"><span class="toc-nav-text">Observer(观察者)模式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Pub-Sub-实现"><span class="toc-nav-text">Pub/Sub 实现</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Mediator-中介者-模式"><span class="toc-nav-text">Mediator(中介者)模式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考链接"><span class="toc-nav-text">参考链接</span></a></li></ol></li></ol></div></aside></main><script>(function () {
    var url = 'https://blog.noobcoder.club/2018/11/13/design-pattern-1/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url + Math.random())
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function () {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function () {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="' + src + '" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function () {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();</script><script>var disqus_shortname="aaron00101010",disqus_url="https://blog.noobcoder.club/2018/11/13/design-pattern-1/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//go.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><div class="scroll-top"><span class="arrow-icon"></span></div></div><footer class="app-footer"><p class="copyright">&copy; 2018 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a><br>Theme by <a href="https://github.com/yanm1ng">yanm1ng</a></p></footer><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){FastClick.attach(document.body)})</script><script>var hasLine="true";async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js",function(){$("figure pre").each(function(t,e){var a=$(this).parents("figure");"false"===hasLine&&a.find(".gutter").hide();var s=a.attr("class").split(" ")[1]||"code",i=$(this).html(),h=document.createElement("code");h.className=s,h.innerHTML=i,$(this).attr("class","").empty().html(h),a.attr("data-lang",s.toUpperCase()),hljs.highlightBlock(e)})})</script><script src="/js/script.js"></script></body></html>