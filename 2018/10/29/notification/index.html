<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta name="description" content="Aaron&#39;s blog"><meta name="keyword" content="blog,front end,css,html,javascript"><link rel="shortcut icon" href="/css/images/logo.png"><title>桌面通知 - Notification API | Aaron&#39;s Blog</title><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet"><link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script><script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script></head><div class="wechat-share"><img src="/css/images/logo.png" alt="logo"></div><body><div id="container"><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/"><div class="logo"></div><span><svg height="60" width="250" id="header-svg"><symbol id="s-text"><text text-anchor="left" x="0%" y="50%" dy=".35em">Aaron's Blog</text></symbol><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use><use class="text" xlink:href="#s-text"></use></svg><style>#header-svg{position:absolute;top:0}@media screen and (max-width:768px){#header-svg{top:-7px}}.text{fill:none;stroke-width:2;stroke-linejoin:round;stroke-dasharray:40 185;stroke-dashoffset:0;-webkit-animation:stroke 8s infinite linear;animation:stroke 8s infinite linear;font-size:40px;line-height:1;height:40px}.text:nth-child(5n+1){stroke:#f2385a;-webkit-animation-delay:-1.6s;animation-delay:-1.6s}.text:nth-child(5n+2){stroke:#f5a503;-webkit-animation-delay:-3.2s;animation-delay:-3.2s}.text:nth-child(5n+3){stroke:#42b983;-webkit-animation-delay:-4.8s;animation-delay:-4.8s}.text:nth-child(5n+4){stroke:#56d9cd;-webkit-animation-delay:-6.4s;animation-delay:-6.4s}.text:nth-child(5n+5){stroke:#3aa1bf;-webkit-animation-delay:-8s;animation-delay:-8s}@-webkit-keyframes stroke{100%{stroke-dashoffset:-225}}@keyframes stroke{100%{stroke-dashoffset:-225}}</style></span></a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/tags/" class="item-link">Tags</a></li><li class="list-item"><a href="/archives/" class="item-link">Archives</a></li><li class="list-item"><a href="/project/" class="item-link">Project</a></li><li class="list-item"><a href="/about/" class="item-link">About</a></li></ul><div class="menu"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></div><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/tags/" class="menu-link">Tags</a></li><li class="menu-item"><a href="/archives/" class="menu-link">Archives</a></li><li class="menu-item"><a href="/project/" class="menu-link">Project</a></li><li class="menu-item"><a href="/about/" class="menu-link">About</a></li></ul></div></div></header><div id="article-banner"><h2>桌面通知 - Notification API</h2><p class="post-date">2018-10-29</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>Notification API 是 HTML5 中用于推送桌面通知的 API,通过这个 API 我们就可以向用户推送消息，拓展了 Web 应用的功能，从后台及时向用户推送桌面信息。<br>兼容性信息：<br><img src="https://ws1.sinaimg.cn/large/e3c02d6fly1fwoxfs19osj20zd0dpt9o.jpg" alt=""><br>虽然兼容性不怎么样，但是对于支持的 API 用户可以渐进增强我们的应用。</p><p>详细信息可参考<a href="https://notifications.spec.whatwg.org/" target="_blank" rel="noopener">Notifications API Live Standard</a></p><h1 id="Notification-API"><a href="#Notification-API" class="headerlink" title="Notification API"></a>Notification API</h1><h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Nofication(title, &#123;</span><br><span class="line">  <span class="comment">/*通知推送方向*/</span></span><br><span class="line">  dir: <span class="string">"auto|ltr|rtl"</span>,</span><br><span class="line">  <span class="comment">/*通知语言*/</span></span><br><span class="line">  lang: <span class="string">"zh|en|..."</span>,</span><br><span class="line">  <span class="comment">/*推送的消息*/</span>/</span><br><span class="line">  body: <span class="string">"i miss you"</span>,</span><br><span class="line">  <span class="comment">/*附带的数据*/</span></span><br><span class="line">  data: &#123; <span class="attr">info</span>: <span class="string">"123"</span> &#125;,</span><br><span class="line">  <span class="comment">/*震动设备震动，停止震动时间的数组，震动与停止交替,</span></span><br><span class="line"><span class="comment">  比如这里震动100ms,停止150ms,震动120ms*/</span></span><br><span class="line">  vibrate: [<span class="number">100</span>, <span class="number">150</span>, <span class="number">120</span>],</span><br><span class="line">  <span class="comment">/*这条通知的标识，相同的Tag会被认为是同一条消息从而不会弹出多条，如果未设置则会弹出多条*/</span></span><br><span class="line">  tag: <span class="string">"notifi233"</span>,</span><br><span class="line">  <span class="comment">/*默认为false,表示通知信息堆叠起来</span></span><br><span class="line"><span class="comment">  设置为true,表示相同通知标识（tag），会被替换而不是堆叠</span></span><br><span class="line"><span class="comment">  因此设置为true必须同时设置tag标识*/</span></span><br><span class="line">  renotify: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">/*展示图片的url*/</span></span><br><span class="line">  icon: <span class="string">"https://placehold.it/100x100"</span>,</span><br><span class="line">  <span class="comment">/*默认false,是否需要交互才隐藏，分为自动隐藏，用户点击隐藏。*/</span></span><br><span class="line">  requireInteraction: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">/*是否有通知音效，默认false,标识静音*/</span></span><br><span class="line">  slient: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><h3 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h3><ul><li><strong>Notification.permission</strong>(read only),只读属性表示是否获取了推送桌面通知的权限,’denied|granted|default’,其中default与denied行为相同。</li></ul><h3 id="实例属性"><a href="#实例属性" class="headerlink" title="实例属性"></a>实例属性</h3><ul><li><strong>Notification.prototype.title/dir/body/tag/icon…</strong>，实例化 Notificaiton option 中设置的属性。</li><li><strong>Notifcation.prototype.onclick</strong>,点击通知事件</li><li><strong>Notifcation.prototype.onshow</strong>,通知显示事件</li><li><strong>Notifcation.prototype.onerror</strong>,通知错误事件</li><li><strong>Notifcation.prototype.onclose</strong>,通知关闭事件</li></ul><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p><strong>Notification.requestPermission()</strong> 向用户请求通知权限。</p><h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ul><li><strong>Notification.prototype.close()</strong> 关闭通知</li><li><strong>Notification.prototype.addEventLisener/removeEventLisener/dispatchEvent</strong> 注册/移除/触发事件方法。</li></ul><h1 id="写个试试"><a href="#写个试试" class="headerlink" title="写个试试"></a>写个试试</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (Notification) &#123;</span><br><span class="line">       <span class="keyword">if</span> (Notification.permission !== <span class="string">'granted'</span>) &#123;</span><br><span class="line">         Notification.requestPermission();</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">let</span> msg = <span class="keyword">new</span> Notification(<span class="string">'weiwei'</span>, &#123;</span><br><span class="line">           dir: <span class="string">'auto'</span>,</span><br><span class="line">           body: <span class="string">'i miss you'</span>,</span><br><span class="line">           data: &#123; <span class="attr">info</span>: <span class="string">'i miss you too'</span> &#125;,</span><br><span class="line">           vibrate: [<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>], </span><br><span class="line">           tag: <span class="string">'msg1'</span>,</span><br><span class="line">           renotify:<span class="literal">false</span>,</span><br><span class="line">           icon: <span class="string">"https://placehold.it/100x100"</span>,</span><br><span class="line">           requireInteraction: <span class="literal">true</span>,</span><br><span class="line">           slient:<span class="literal">false</span></span><br><span class="line">         &#125;);</span><br><span class="line">         [<span class="string">'click'</span>,<span class="string">'show'</span>,<span class="string">'error'</span>,<span class="string">'close'</span>].forEach(<span class="function"><span class="params">eventName</span>=&gt;</span>&#123;</span><br><span class="line">           msg.addEventListener(eventName,(e)=&gt;&#123;</span><br><span class="line">             <span class="built_in">console</span>.log(e.type)</span><br><span class="line">             <span class="keyword">if</span>(e.type === <span class="string">'click'</span>)&#123;</span><br><span class="line">               <span class="comment">//点击跳转网页</span></span><br><span class="line">               <span class="built_in">window</span>.open(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">             &#125;</span><br><span class="line">           &#125;)</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="comment">//定时通知关闭</span></span><br><span class="line">         <span class="comment">// setTimeout(()=&gt;&#123;</span></span><br><span class="line">         <span class="comment">//   msg.close()</span></span><br><span class="line">         <span class="comment">// &#125;,3000)</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       alert(<span class="string">'浏览器不支持Notification'</span>)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>以上代码在PC上测试可以正常工作，虽然can i use中有部分浏览器支持，但是如在Android Chorme浏览器中确会报错(Failed to construct Notification: Illegal constructor)，由于系统机制的原因废弃了这个API,因此在移动端Notification API就不要想了。,<br>具体<a href="https://code.google.com/p/chromium/issues/detail?id=481856" target="_blank" rel="noopener">issues</a>。<br>摘要：<br>new Notification() is on the path to deprecation, because it implicitly assumes that the page will outlive the notification, which is very unlikely on mobile (and far from guaranteed on desktop too).<br>Hence we will never implement it on Android. We might one day remove it on desktop too, after a deprecation period.<br>Websites should use ServiceWorkerRegistration.showNotification() (see spec) instead whenever it is available.<br>The best way I can think of to feature-detect new Notification() is to try it (before you have permission) and catch the error:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNewNotificationSupported</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">window</span>.Notification || !Notification.requestPermission)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (Notification.permission == <span class="string">'granted'</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'You must only call this *before* calling Notification.requestPermission(), otherwise this feature detect would bug the user with an actual notification!'</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> Notification(<span class="string">''</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.name == <span class="string">'TypeError'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>You could then use it like this:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.Notification &amp;&amp; Notification.permission == <span class="string">'granted'</span>) &#123;</span><br><span class="line">    <span class="comment">// We would only have prompted the user for permission if new</span></span><br><span class="line">    <span class="comment">// Notification was supported (see below), so assume it is supported.</span></span><br><span class="line">    doStuffThatUsesNewNotification();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (isNewNotificationSupported()) &#123;</span><br><span class="line">    <span class="comment">// new Notification is supported, so prompt the user for permission.</span></span><br><span class="line">    showOptInUIForNotifications();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>这里还有一个服务器结合Web Push推送桌面消息的文章<a href="https://developers.google.com/web/fundamentals/codelabs/push-notifications/" target="_blank" rel="noopener">向网络应用添加推送通知</a></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification" target="_blank" rel="noopener">Notificaiton-MDN</a><br><a href="https://www.zhangxinxu.com/wordpress/2016/07/know-html5-web-notification/" target="_blank" rel="noopener">简单了解 HTML5 中的 Web Notification 桌面通知</a></p></section><div class="tags"><span>Tags:</span> <a href="/tags#notification"><span class="tag-code">notification</span></a></div><div class="nav-container"><a class="nav-left" href="/2018/10/28/aria/"><span class="nav-arrow">← </span>WAI-ARIA了解一下</a></div><div id="disqus_thread"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Notification-API"><span class="toc-nav-text">Notification API</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#构造方法"><span class="toc-nav-text">构造方法</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#属性"><span class="toc-nav-text">属性</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#静态属性"><span class="toc-nav-text">静态属性</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#实例属性"><span class="toc-nav-text">实例属性</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#方法"><span class="toc-nav-text">方法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#静态方法"><span class="toc-nav-text">静态方法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#实例方法"><span class="toc-nav-text">实例方法</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#写个试试"><span class="toc-nav-text">写个试试</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考链接"><span class="toc-nav-text">参考链接</span></a></li></ol></li></ol></div></aside></main><script>(function () {
    var url = 'https://blog.noobcoder.club/2018/10/29/notification/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url + Math.random())
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function () {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function () {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="' + src + '" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function () {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();</script><script>var disqus_shortname="aaron00101010",disqus_url="https://blog.noobcoder.club/2018/10/29/notification/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//go.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><div class="scroll-top"><span class="arrow-icon"></span></div></div><footer class="app-footer"><p class="copyright">&copy; 2018 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a><br>Theme by <a href="https://github.com/yanm1ng">yanm1ng</a></p></footer><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){FastClick.attach(document.body)})</script><script>var hasLine="true";async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js",function(){$("figure pre").each(function(t,e){var a=$(this).parents("figure");"false"===hasLine&&a.find(".gutter").hide();var s=a.attr("class").split(" ")[1]||"code",i=$(this).html(),h=document.createElement("code");h.className=s,h.innerHTML=i,$(this).attr("class","").empty().html(h),a.attr("data-lang",s.toUpperCase()),hljs.highlightBlock(e)})})</script><script src="/js/script.js"></script></body></html>